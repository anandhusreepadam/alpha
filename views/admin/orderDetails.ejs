<%-include("../../views/partials/admin/header")%>
<section class="content-main">
    <div class="content-header">
        <h2 class="content-title">Order Details</h2>
        <a href="/admin/orders" class="btn btn-secondary">Back to Orders</a>
    </div>

    <div class="card mb-4">
        <header class="card-header">
            <h4>Order: <%= order.orderId %></h4>
            <small>Placed on: <%= new Date(order.createdAt).toLocaleString() %></small>
        </header>

        <div class="card-body">
            <!-- Customer Details -->
            <h5>Customer Details</h5>
            <ul>
                <li><strong>Name:</strong> <%= order.userId.name %></li>
                <li><strong>Email:</strong> <%= order.userId.email %></li>
                <li><strong>Phone:</strong> <%= order.userId.phone %></li>
            </ul>

            <!-- Order Status -->
            <h5>Order Status</h5>
            <p>
                <span class="badge rounded-pill 
                    <%= order.status === 'Delivered' ? 'alert-success' : order.status === 'Cancelled' ? 'alert-danger' : 'alert-warning' %>">
                    <%= order.status %>
                </span>
            </p>

            <!-- Payment and Address -->
            <h5>Payment & Address</h5>
            <ul>
                <li><strong>Payment Method:</strong> <%= order.paymentMethod %></li>
                <li><strong>Address:</strong> <%= order.address.fullAddress || 'Not provided' %></li>
            </ul>

            <!-- Order Items -->
            <h5>Items Ordered</h5>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% order.items.forEach(item => { %>
                            <tr>
                                <td>
                                    <img src="/uploads/re-image/<%=item.productId.productImage[0]%>" 
                                         alt="<%= item.productId.productName %>"
                                         class="img-thumbnail" 
                                         style="width: 50px; height: 50px; object-fit: cover;" />
                                    <%= item.productId.productName %>
                                </td>
                                <td><%= item.quantity %></td>
                                <td>₹<%= item.productId.salePrice%></td>
                                <td>₹<%= (item.quantity * item.productId.salePrice) %></td>
                            </tr>
                        <% }); %>
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3" class="text-end">Total Amount</th>
                            <th>₹<%= order.totalAmount.toFixed(2) %></th>
                        </tr>
                        <tr>
                            <th colspan="3" class="text-end">Final Amount (incl. taxes/discounts)</th>
                            <th>₹<%= order.finalAmount.toFixed(2) %></th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</section>
<%-include("../../views/partials/admin/footer")%>